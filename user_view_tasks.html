<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>My Assigned Tasks</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<style>
  body { background: #f8f9fa; }
  .container { margin-top: 50px; max-width: 900px; }
  .card { border-radius: 1rem; box-shadow: 0 0 12px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<div class="container">
  <div class="card p-4">
    <h3 class="mb-4 text-primary">My Assigned Tasks</h3>
    <table class="table table-bordered table-hover">
      <thead class="table-light">
        <tr>
          <th>#</th>
          <th>Task</th>
          <th>Description</th>
          <th>Date</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="taskTableBody"></tbody>
    </table>
  </div>
</div>

<script>
const currentUser = JSON.parse(localStorage.getItem("currentUser"));

if(!currentUser){
  alert("No user logged in!");
  window.location.href = "login_form.html";
}

function loadTasks(){
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const userTasks = tasks.filter(t => t.username === currentUser.username);
  const tbody = document.getElementById("taskTableBody");
  tbody.innerHTML = "";

  if(userTasks.length === 0){
    tbody.innerHTML = `<tr><td colspan="5" class="text-center">No tasks assigned.</td></tr>`;
    return;
  }

  userTasks.forEach((t,index) => {
    const isDone = t.status === "Completed" || t.status === "Done";
    tbody.innerHTML += `
      <tr>
        <td>${index+1}</td>
        <td>${t.task}</td>
        <td>${t.description}</td>
        <td>${t.date}</td>
        <td>
          ${isDone ? `<span class="badge bg-success">Completed</span>` : `<button class="btn btn-sm btn-success" onclick="markDone(${t.id})">Done</button>`}
        </td>
      </tr>
    `;
  });
}

function markDone(taskId){
  const tasks = JSON.parse(localStorage.getItem("tasks")) || [];
  const task = tasks.find(t => t.id === taskId);
  if(task){
    task.status = "Completed";  // update status
    localStorage.setItem("tasks", JSON.stringify(tasks));
    loadTasks();
    alert("Task marked as Completed!");
  }
}

window.onload = loadTasks;
</script>

</body>
</html>
