<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Edit User</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background: linear-gradient(to right, #f0f9ff, #e0f7fa);
      font-family: 'Segoe UI', sans-serif;
    }
    .container {
      margin-top: 60px;
      max-width: 700px;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }
  </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark px-3">
  <span class="navbar-brand">Edit User</span>
  <div class="ms-auto d-flex gap-2">
    <button class="btn btn-outline-light" onclick="history.back()">Back</button>
    <button class="btn btn-outline-light" onclick="window.location.href='login_form.html'">Logout</button>
  </div>
</nav>

<div class="container">
  <div class="card p-4">
    <h4 class="text-primary mb-4">Modify User Details</h4>

    <!-- Search User -->
    <div class="mb-3">
      <label class="form-label">Enter Username to Edit</label>
      <div class="input-group">
        <input type="text" id="searchUsername" class="form-control" placeholder="Type username..." required>
        <button class="btn btn-secondary" onclick="findUser()">Search</button>
      </div>
    </div>

    <form id="editForm" onsubmit="saveChanges(event)" style="display:none;">
      <div class="mb-3">
        <label class="form-label">Username</label>
        <input type="text" id="username" class="form-control" readonly>
      </div>
      <div class="mb-3">
        <label class="form-label">Change Password</label>
        <input type="password" id="password" class="form-control" placeholder="Leave blank to keep current">
      </div>
      <div class="mb-3">
        <label class="form-label">Role</label>
        <select id="role" class="form-select" required>
  <option value="admin">Admin</option>
  <option value="user">User</option>
  <option value="superadmin">SuperAdmin</option>
</select>

      </div>
      <div class="mb-3">
        <label class="form-label">Status</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="status" value="Active" id="activeStatus">
          <label class="form-check-label" for="activeStatus">Active</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="status" value="Inactive" id="inactiveStatus">
          <label class="form-check-label" for="inactiveStatus">Inactive</label>
        </div>
      </div>
      <div class="d-grid mt-4">
        <button class="btn btn-primary" type="submit">Save Changes</button>
      </div>
    </form>
  </div>
</div>

<script>
  // Get accounts from local storage
  let accounts = JSON.parse(localStorage.getItem("accounts")) || [];

  function findUser() {
    const username = document.getElementById("searchUsername").value.trim();
    const user = accounts.find(acc => acc.username === username);

    if (!user) {
      alert("User not found!");
      document.getElementById("role").value = user.baseRole;
      return;
    }

    // Fill form with user details
    document.getElementById("username").value = user.username;
    document.getElementById("password").value = "";
    document.getElementById("role").value = user.role;
    if (user.status === "Active") {
      document.getElementById("activeStatus").checked = true;
    } else {
      document.getElementById("inactiveStatus").checked = true;
    }

    document.getElementById("editForm").style.display = "block";
  }

  function saveChanges(event) {
  event.preventDefault();

  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value.trim();
  const role = document.getElementById("role").value.toLowerCase(); // match lowercase format in login
  const status = document.querySelector('input[name="status"]:checked').value;

  const index = accounts.findIndex(acc => acc.username === username);

  if (index === -1) {
    alert("Error: User not found in storage!");
    return;
  }

  // Only change password if something is entered
  if (password !== "") {
    accounts[index].password = password;
  }

  // Store as baseRole so login script can use it
  accounts[index].baseRole = role;  
  accounts[index].status = status;

  localStorage.setItem("accounts", JSON.stringify(accounts));

  alert("User updated successfully!");
  document.getElementById("editForm").style.display = "none";
  document.getElementById("searchUsername").value = "";
}
</script>

</body>
</html>
